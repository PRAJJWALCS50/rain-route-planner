{"ast":null,"code":"import React,{useEffect,useRef}from'react';import L from'leaflet';import'leaflet/dist/leaflet.css';import{jsx as _jsx}from\"react/jsx-runtime\";const RADAR_TEMPLATES=[// Allow override via env\nprocess.env.REACT_APP_RADAR_TILE_URL_TEMPLATE||'',// RainViewer variants (try in order)\n'https://tilecache.rainviewer.com/v2/radar/nowcast/256/{z}/{x}/{y}/2/1_1.png','https://tilecache.rainviewer.com/v2/radar/nowcast_0/256/{z}/{x}/{y}/2/1_1.png','https://tilecache.rainviewer.com/v2/radar/last/256/{z}/{x}/{y}/2/1_1.png'].filter(Boolean);const MapView=_ref=>{let{routePath=[],alerts=[]}=_ref;const mapRef=useRef(null);const mapInstanceRef=useRef(null);const routeLayerRef=useRef(null);const markersRef=useRef([]);useEffect(()=>{if(!mapInstanceRef.current){mapInstanceRef.current=L.map(mapRef.current,{center:[22.9734,78.6569],// India approx center\nzoom:5});L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; OpenStreetMap contributors'}).addTo(mapInstanceRef.current);// Radar overlay with fallback templates\nconst tryTemplates=[...RADAR_TEMPLATES];const addRadarFromTemplate=()=>{if(tryTemplates.length===0)return;// give up silently\nconst tpl=tryTemplates.shift();const layer=L.tileLayer(tpl,{opacity:0.6,zIndex:400,tileSize:256,crossOrigin:true});let anyTileLoaded=false;const successOnce=()=>{anyTileLoaded=true;layer.off('tileload',successOnce);};const onErr=()=>{// if nothing loaded yet, fallback to next template\nsetTimeout(()=>{if(!anyTileLoaded){layer.remove();addRadarFromTemplate();}},200);};layer.on('tileload',successOnce);layer.on('tileerror',onErr);layer.addTo(mapInstanceRef.current);};addRadarFromTemplate();}// Clear previous layers\nif(routeLayerRef.current){routeLayerRef.current.remove();routeLayerRef.current=null;}markersRef.current.forEach(m=>m.remove());markersRef.current=[];// Draw route\nif(routePath.length>1){const latlngs=routePath.map(p=>[p.lat,p.lng]);routeLayerRef.current=L.polyline(latlngs,{color:'#4f46e5',weight:5,opacity:0.8}).addTo(mapInstanceRef.current);mapInstanceRef.current.fitBounds(routeLayerRef.current.getBounds(),{padding:[20,20]});}// Draw markers\nalerts.forEach(a=>{if(!a.coords)return;const isRain=a.severity==='high';const marker=L.circleMarker([a.coords.lat,a.coords.lng],{radius:6,color:isRain?'#dc2626':'#16a34a',fillColor:isRain?'#ef4444':'#22c55e',fillOpacity:0.9,weight:2}).addTo(mapInstanceRef.current);const popupHtml=\"\\n        <div style=\\\"min-width:200px\\\">\\n          <strong>\".concat(a.location,\"</strong><br/>\\n          \").concat(a.alert,\"<br/>\\n          <div style=\\\"margin-top:6px;font-size:12px;\\\">\\n            \").concat(a.weatherData?\"Temp: \".concat(a.weatherData.temperature,\"&deg;C | \").concat(a.weatherData.description):'Weather: N/A',\"\\n          </div>\\n        </div>\\n      \");marker.bindPopup(popupHtml);markersRef.current.push(marker);});},[routePath,alerts]);return/*#__PURE__*/_jsx(\"div\",{style:{height:'420px',width:'100%',borderRadius:12,overflow:'hidden',boxShadow:'0 10px 20px rgba(0,0,0,0.1)'},ref:mapRef});};export default MapView;","map":{"version":3,"names":["React","useEffect","useRef","L","jsx","_jsx","RADAR_TEMPLATES","process","env","REACT_APP_RADAR_TILE_URL_TEMPLATE","filter","Boolean","MapView","_ref","routePath","alerts","mapRef","mapInstanceRef","routeLayerRef","markersRef","current","map","center","zoom","tileLayer","maxZoom","attribution","addTo","tryTemplates","addRadarFromTemplate","length","tpl","shift","layer","opacity","zIndex","tileSize","crossOrigin","anyTileLoaded","successOnce","off","onErr","setTimeout","remove","on","forEach","m","latlngs","p","lat","lng","polyline","color","weight","fitBounds","getBounds","padding","a","coords","isRain","severity","marker","circleMarker","radius","fillColor","fillOpacity","popupHtml","concat","location","alert","weatherData","temperature","description","bindPopup","push","style","height","width","borderRadius","overflow","boxShadow","ref"],"sources":["C:/Users/prajj/OneDrive/Desktop/rain/client/src/MapView.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\nconst RADAR_TEMPLATES = [\n  // Allow override via env\n  process.env.REACT_APP_RADAR_TILE_URL_TEMPLATE || '',\n  // RainViewer variants (try in order)\n  'https://tilecache.rainviewer.com/v2/radar/nowcast/256/{z}/{x}/{y}/2/1_1.png',\n  'https://tilecache.rainviewer.com/v2/radar/nowcast_0/256/{z}/{x}/{y}/2/1_1.png',\n  'https://tilecache.rainviewer.com/v2/radar/last/256/{z}/{x}/{y}/2/1_1.png'\n].filter(Boolean);\n\nconst MapView = ({ routePath = [], alerts = [] }) => {\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const routeLayerRef = useRef(null);\n  const markersRef = useRef([]);\n\n  useEffect(() => {\n    if (!mapInstanceRef.current) {\n      mapInstanceRef.current = L.map(mapRef.current, {\n        center: [22.9734, 78.6569], // India approx center\n        zoom: 5,\n      });\n\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        maxZoom: 19,\n        attribution: '&copy; OpenStreetMap contributors',\n      }).addTo(mapInstanceRef.current);\n\n      // Radar overlay with fallback templates\n      const tryTemplates = [...RADAR_TEMPLATES];\n      const addRadarFromTemplate = () => {\n        if (tryTemplates.length === 0) return; // give up silently\n        const tpl = tryTemplates.shift();\n        const layer = L.tileLayer(tpl, {\n          opacity: 0.6,\n          zIndex: 400,\n          tileSize: 256,\n          crossOrigin: true\n        });\n        let anyTileLoaded = false;\n        const successOnce = () => { anyTileLoaded = true; layer.off('tileload', successOnce); };\n        const onErr = () => {\n          // if nothing loaded yet, fallback to next template\n          setTimeout(() => {\n            if (!anyTileLoaded) {\n              layer.remove();\n              addRadarFromTemplate();\n            }\n          }, 200);\n        };\n        layer.on('tileload', successOnce);\n        layer.on('tileerror', onErr);\n        layer.addTo(mapInstanceRef.current);\n      };\n      addRadarFromTemplate();\n    }\n\n    // Clear previous layers\n    if (routeLayerRef.current) {\n      routeLayerRef.current.remove();\n      routeLayerRef.current = null;\n    }\n    markersRef.current.forEach(m => m.remove());\n    markersRef.current = [];\n\n    // Draw route\n    if (routePath.length > 1) {\n      const latlngs = routePath.map(p => [p.lat, p.lng]);\n      routeLayerRef.current = L.polyline(latlngs, { color: '#4f46e5', weight: 5, opacity: 0.8 }).addTo(mapInstanceRef.current);\n      mapInstanceRef.current.fitBounds(routeLayerRef.current.getBounds(), { padding: [20, 20] });\n    }\n\n    // Draw markers\n    alerts.forEach(a => {\n      if (!a.coords) return;\n      const isRain = a.severity === 'high';\n      const marker = L.circleMarker([a.coords.lat, a.coords.lng], {\n        radius: 6,\n        color: isRain ? '#dc2626' : '#16a34a',\n        fillColor: isRain ? '#ef4444' : '#22c55e',\n        fillOpacity: 0.9,\n        weight: 2,\n      }).addTo(mapInstanceRef.current);\n\n      const popupHtml = `\n        <div style=\"min-width:200px\">\n          <strong>${a.location}</strong><br/>\n          ${a.alert}<br/>\n          <div style=\"margin-top:6px;font-size:12px;\">\n            ${a.weatherData ? `Temp: ${a.weatherData.temperature}&deg;C | ${a.weatherData.description}` : 'Weather: N/A'}\n          </div>\n        </div>\n      `;\n      marker.bindPopup(popupHtml);\n      markersRef.current.push(marker);\n    });\n  }, [routePath, alerts]);\n\n  return (\n    <div style={{ height: '420px', width: '100%', borderRadius: 12, overflow: 'hidden', boxShadow: '0 10px 20px rgba(0,0,0,0.1)' }} ref={mapRef} />\n  );\n};\n\nexport default MapView;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}